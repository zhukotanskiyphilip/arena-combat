# BUG 001: Методологія дослідження

## Статус: НЕ ВИРІШЕНО

Баг позначено як "resolved" помилково. Насправді проблема залишається.

---

## Проблема

**Очікувана поведінка:** Коли я кручу камеру мишкою вліво, персонаж теж повертається вліво (як Q клавіша).

**Фактична поведінка:** Q/E працює - персонаж крутиться. Мишка НЕ працює - персонаж НЕ крутиться візуально.

---

## Що пробували

### 1. Логування (ЗРОБЛЕНО)
- Створили `debug_log.rs` модуль
- Логи пишуться в `debug/game_debug.log`
- Додали логи: SYNC, MOUSE, Q_KEY, UPDATE_PLAYER, BODY_FORWARD, GPU_upload

### 2. Аналіз логів (ЗРОБЛЕНО)
Логи показують що код ВИКОНУЄТЬСЯ:
```
MOUSE: cam_yaw=90.7° player_yaw=270.7° delta=0.009
UPDATE_PLAYER: yaw=270.7°
GPU upload model[0]: [...]
```

### 3. Висновок (ПОМИЛКОВИЙ)
Було зроблено висновок що "все працює, просто камера і персонаж крутяться разом".

**Але це НЕ пояснює чому Q/E ВІЗУАЛЬНО крутить персонажа, а мишка - ні!**

---

## Що НЕ перевірено

### 1. Порівняння Q/E vs Mouse в одному тесті
Потрібно записати лог де:
1. Спочатку крутимо Q/E (бачимо обертання)
2. Потім крутимо мишкою (не бачимо обертання)
3. Порівняти значення в логах

### 2. Візуальний маркер
Додати яскравий об'єкт (стрілка, куб) який показує player.yaw напрямок.
Якщо маркер крутиться з мишкою - проблема в камері.
Якщо маркер НЕ крутиться - проблема в player.yaw.

### 3. Заморозити камеру
Тимчасово прибрати `camera.rotate_third_person()`.
Мишка має крутити ТІЛЬКИ персонажа.
Якщо персонаж крутиться - проблема в синхронному обертанні.

### 4. Перевірити update_player викликається з правильним mesh
Можливо `player_mesh` це не той mesh що рендериться?
Або є кілька mesh і оновлюється не той?

---

## Методологія для наступної сесії

### Крок 1: Читати документацію
```
debug/PATHS.md - шляхи до файлів
debug/BUG_001_*.md - історія дослідження
debug/SESSION_*.md - підсумки сесій
```

### Крок 2: Простий тест
```rust
// Тимчасово в main.rs:
// 1. Закоментувати camera.rotate_third_person()
// 2. Залишити тільки player.yaw += delta_yaw
// 3. Запустити і перевірити чи персонаж крутиться
```

### Крок 3: Візуальний маркер
Якщо персонаж НЕ крутиться без камери - проблема глибше.
Додати debug cube що показує player.yaw:
```rust
// В renderer.rs
let debug_arrow_pos = player.position + Vec3::new(
    player.yaw.sin() * 2.0,
    0.5,
    player.yaw.cos() * 2.0
);
```

### Крок 4: Порівняти матриці
Логувати model matrix для Q/E і для мишки.
Якщо матриці однакові - проблема не в transform.
Якщо різні - знайти де різниця.

---

## Ключове питання

**Чому один і той самий код (`player.yaw += delta`) працює для Q/E але не для мишки?**

Можливі причини:
1. Delta для мишки занадто малий?
2. Щось скидає player.yaw після mouse handler?
3. Камера якось впливає на рендеринг персонажа?
4. Різний порядок виконання для Q/E vs mouse?

---

## Файли для перевірки

| Файл | Що шукати |
|------|-----------|
| `src/main.rs:300-340` | Mouse + Q/E rotation handlers |
| `src/main.rs:348-350` | renderer.update_player() call |
| `src/rendering/renderer.rs:540-575` | update_player() implementation |
| `src/camera/camera.rs` | rotate_third_person(), update_third_person() |

---

## Команди для тестування

```bash
# Запустити гру
cd c:\Claude\arena_combat
cargo run

# Подивитися логи
cat debug/game_debug.log

# Фільтрувати логи
grep "MOUSE\|Q_KEY" debug/game_debug.log
```

---

## Правила роботи

1. **Не робити висновки без візуального підтвердження**
2. **Один тест = одна зміна**
3. **Логувати ВСЕ**
4. **Комітити після кожної сесії**
5. **Документувати що пробували і результат**
